풀면서 좀 헤맸던 문제들만 정리해봤다.

## G. 보석 분배

문제 요약)

$N$개의 보석이 있다. 각 보석은 $(P_i, J_i)$ 라는 두 개의 가치로 이루어져 있다. 각각 Petra가 해당 보석을 가질 경우에는 $P_i$의 가치, Jan이 가질 경우에는 $J_i$의 가치를 가진다는 뜻.

이 때 Petra와 Jan은 각각 아래의 전략에 따라 보석을 가져간다.

- Petra: 남아있는 보석 중에서 본인에게 가장 가치 있는 보석을 가져간다. 그런게 여러가지라면, Jan에게 가장 가치가 없는 보석을 고른다.
- Jan: 최종적으로 본인이 가지게 되는 보석의 가치 합이 가장 크게 되게 가져간다(Petra의 전략을 고려해서). 그런게 여러가지면 Petra의 보석 가치 합이 최대가 되게 가져간다.

둘은 위 전략에 따라 보석을 번갈아가며 하나씩 가져간다. 처음 가져가기 시작하는 사람이 주어졌을 때 둘이 최종적으로 갖게 되는 보석 가치 합 계산하기

### 접근

$N$ 제한이 1000인데 임의의 보석을 가져갈 수가 있어서 일단 다항 시간 해법을 떠올리기가 어렵다. 지수적으로 모든 경우의 수를 따져보는 풀이는 쉽게 생각할 수 있지만, 여기서 그다지 얻을 수 있는 개선 사항이 보이지 않는다.

일단 생각해볼 수 있는 특징은, Petra의 경우 남아있는 보석 세트가 정해지면 뭘 가져갈지도 항상 바로 결정된다는 점이다. Jan의 경우는 최종적인 가치 합이 크게 가져가기 때문에 매 단계에서 뭘 고르는게 최선인지 쉽게 계산하기가 어렵다. 따라서 Petra의 전략이 가진 특징을 잘 이용해볼 방법이 없을까 하는 생각이 든다.

이를 잘 이용하기 위해 보석을 Petra가 고르는 우선순위가 높은 순서대로 정렬해보자. 즉, $P_i$가 높은게 우선, $P_i$가 같다면 $J_i$가 작은게 우선이 되도록 정렬한다. 이렇게 정렬할 경우 Petra는 남은 보석에서 항상 맨 앞의 보석을 가져가는 것으로 생각할 수 있다.

이렇게 정리를 하고 보면 Petra의 전략은 단순하지만 Jan이 행할 수 있는 전략은 여전히 가짓수가 너무 많다. 매턴 임의의 보석을 고르는 모든 경우를 봐야하는데 이걸 어떻게하면 줄일 수 있을지 생각해보자.

우리가 알고 있는 유용한 성질이 **Petra는 남은 보석 중 가장 앞의 것을 가져간다**니까 이걸 써서 고려할 가짓수를 줄일 수 있는지 생각해보자. 생각할 수 있는 건, Jan도 뒤쪽 보석을 먼저 고르고 앞쪽 보석을 고를 이유는 없다는 것이다. 왜냐하면, Petra는 남은 것 중 맨 앞의 보석부터 가져가니까 뒤쪽 보석을 먼저 고르고 그 다음 턴에 앞쪽 보석을 고르는게 가능하다면 그 반대도 항상 가능하기 때문이다. 순서상 앞쪽 보석이 먼저 사라지므로 Jan이 뒤쪽 보석을 먼저 가져갈 이유가 없다.

이러면 Jan의 전략도 순서를 고정해놓고 생각할 수 있다. 대충 아래와 같은 함수를 생각하는 것이다.

$f(i)$ = $i..N$ 번째 보석만 고려했을 때 Petra와 Jan이 가지게 될 최종 보석 가치 합

이 함수 정의만 가지고는 조금 부족하다. Jan이 어떤 $i+k$ 번째 보석을 가져갔을 때 Petra가 $i$번 보석을 가져가고 나서, 그 다음 상태를 어떻게 정의해야 할지 애매해지기 때문이다.

Jan도 항상 앞에서부터 순서대로 보석을 가져갈지 말지를 고르는 거니까, 어떤 $i$번 보석을 가져가지 않았다면 그 보석은 무조건 Petra가 가지게 된다. 따라서 매 $i$번 스텝마다 Jan이 가지지 않은 보석을 Petra에게 주고, 앞쪽에서 Petra가 가지게 될 보석이 얼마나 되는지를 상태로 관리한다고 생각하자. 즉, 함수의 정의가 아래와 같이 바뀐다.

$f(p,i)$ = $i..N$번째 보석만 고려했을 때 Petra와 Jan이 가지게 될 최종 보석 가치 합. 이 때, $1..i-1$번째 보석중 Petra가 가질 보석이 $p$개 존재.

이렇게 가정하고 나면 Jan이 $i$번째 보석을 가지는 경우와 아닌 경우를 아래와 같이 나눠서 다음 상태 유도가 가능하다.

- $i$번째 보석을 가지는 경우 : Petra도 맨 앞에서 보석을 하나 가져간다. $p=0$이라면 다음 상태는 $f(0,i+2)$ 가 된다. 앞에 Petra가 가질 보석이 하나도 없으므로, Jan이 $i$번째를 가져가면 Petra는 $i+1$번째를 가져가게 되기 때문. $p>0$이라면, 다음 상태는 $f(p-1,i+1)$ 이 된다. 앞쪽 $p$개 중에 Petra가 하나를 가져가게 되기 때문이다.
- $i$번째 보석을 가져가지 않는 경우 : 다음 상태는 $f(p+1,i+1)$이 된다. $i$번째 보석을 Jan이 갖지 않고 Petra에게 주는 것이기 때문이다.

이 수식 하에서 적절히 Jan과 Petra가 가지게 되는 보석 가치 변화를 계산하고 최적을 구하면 $O(N^2)$에 문제를 해결할 수 있다(DP의 부분 문제가 $O(N^2)$개, 각각의 부분 문제를 $O(1)$에 해결할 수 있으므로).

## H. Delivery Delays

문제 요약) $N$개의 정점과 $M$개의 간선으로 이루어진 무방향 가중치 그래프가 주어진다. 각 정점은 도시, 간선은 도로로 생각할 수 있다. $1$번 정점에 있는 가게에서 배달을 할 건데, 배달 주문 목록이 $k$개 주어진다. 각각의 배달 주문은 $s_i,u_i,t_i$의 3개 변수로 표현된다. 이는 각각 $u_i$번 도시에서 배달 주문이 $s_i$ 시간에 왔고, $t_i$ 시간에 준비가 완료돼서 배달을 시작할 수 있다는 것이다.

배달은 항상 순서대로 이루어진다( $s_i \lt s_{i+1}, t_i \lt t_{i+1}$ ). 각 배달에 대해 배달을 끝마치는데 까지 걸리는 시간을 $d_i$라고 하자. $d_i$의 최댓값이 최소가 되게끔 배달을 하고 싶다. 이 값을 계산하라

### 접근

일단 임의의 정점에서 다른 임의의 정점으로 가는 거리를 구할 수 있어야한다. $n \le 1000, m \le 5000$이므로 이 계산은 모든 정점을 시작점으로 잡고 다익스트라를 돌려주는 것으로 미리 끝내놓을 수 있다. 시간 복잡도는 $O(N \cdot (N+M)logN)$.

이제 배달을 하는 과정이 문제인데... 결국 시작점으로 왔다갔다를 어느 타이밍에 끊어줄지의 문제로 생각할 수 있다. 즉 $1$번 주문부터 $K$번 주문를 여러 개의 구간으로 잘라서, 어떤 연속한 구간 $l \dots r$ 번째 배달을 전부 들고 나가서 $1$에서 $l$, $l$에서 $l+1$, $l+1$에서 $l+2$, ... $r-1$에서 $r$로 배달을 끝내고 $r$에서 $1$로 돌아온 다음 그 다음 주문들을 들고 나가는 식으로 배달을 하는 것.

문제는 어떤 $i$번째 시점에서 배달을 시작하는 시간이 언제일지 결정지을 수가 없다는 점에 있다. 가장 나이브하게 생각할 수 있는 방법은

$f(d, i)$ = 현재 시간이 $d$일 때 $i..N$번째 배달을 전부 끝마칠 때 $d_i$ 최댓값의 최소

라고 정의하고 이를 푸는건데, $d$의 범위가 너무 커서 이런 DP로는 답을 시간 안에 구할 수가 없다.

그리고 이 상태에서 이 DP를 최적화를 하려고 하다가 망하고 문제를 못 풀었다.

답지를 보고 풀었는데.. 중간에 parametric search가 가능한가? 생각했다가 안 될 것 같아서 치웠는데 parametric search를 쓰는게 맞았다. 각각의 접근 방향을 좀 더 충분히 고민을 해보고 넘겼어야 했는데 대충 넘겨버린게 문제였다.

문제를 앞에서부터 뒤로 해결하는게 어렵기 때문에, 뒤에서부터 앞으로 해결을 한다. 일단 parametric search의 각 과정에서 답 $D$를 고정했다고 생각한다. 즉, 모든 주문을 $s_i + D$ 시간 내에 끝마칠 수 있어야 한다.

여기서, $x_i$ = $i \dots N$번째 주문을 모두 끝마칠 수 있는 **가장 늦은 출발 시간** 이라고 정의한다. $i$번째보다 앞의 출발 시간을 고려하는게 어려우니, 그걸 다 빼놓고 그냥 가능한 최대 시작 시간을 찾는 것이다.

이렇게 정의하면, $i$번째부터 임의의 $j$번째까지를 한 세트로 돌고 $j+1$번째부터 시작하는건 $x_{j+1}$번 값을 이용해 빠르게 계산할 수 있다. 따라서, $i$ 가 감소하는 순서대로 $x$ 테이블을 채우면 이 과정은 $O(K^2)$ 시간에 끝마칠 수 있다.

따라서 전체 시간복잡도 $O(N \cdot (N+M)logN + K^2logD)$ 에 문제를 풀 수 있다. $N,M,K$ 제한이 전부 작고 시간 제한이 5초나 돼서 넉넉하게 돈다.
